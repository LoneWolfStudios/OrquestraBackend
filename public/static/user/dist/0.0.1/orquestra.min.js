/*! orquestra 2016-06-24 */
function view(a){return APP_URL+"/user/"+a}function api_v1(a){return APP_URL+"/api/v1/"+a}function attr(a,b){for(var c in b)a[c]=b[c]}var OrquestraUser=angular.module("OrquestraUser",["ui.router"]),APP_URL=$("#APP_URL").val();OrquestraUser.run([function(){}]),OrquestraUser.factory("Device",["PinRepository",function(a){var b=new Function;return b.prototype.pins=function(){return a.byDevice(this.id)},b}]),OrquestraUser.factory("Pin",[function(){var a=new Function;return a}]),OrquestraUser.factory("User",["DeviceRepository",function(a){var b=new Function;return b.prototype.devices=function(){return a.byUser(this.id)},b}]),OrquestraUser.service("Breadcumb",[function(){var a=this;a.title="Teste",a.items=[]}]),OrquestraUser.service("CurrentUser",["$http","$q","User",function(a,b,c){var d=this,e=!1;d.get=function(){var d=b.defer();return e?d.resolve(e):a.get(api_v1("user")).then(function(a){var b=new c;_.extend(b,a.data),e=b,d.resolve(e)}),d.promise}}]),OrquestraUser.service("DeviceRepository",["$http","$q","Device",function(a,b,c){var d={};return d.find=function(d){var e=b.defer();return a.get(api_v1("device/"+d)).then(function(a){var b=new c;attr(b,a.data),e.resolve(b)}),e.promise},d.save=function(c){var d=b.defer(),e={nickname:c.nickname,desc:c.desc,user_id:c.user_id};return a.post(api_v1("device/create"),e).then(function(a){c.id=a.data.id,d.resolve(c)},function(a){d.reject(a)}),d.promise},d.byUser=function(d){var e=b.defer();return a.get(api_v1("device/byUser/"+d)).then(function(a){var b=_.map(a.data,function(a){var b=new c;return attr(b,a),b});e.resolve(b)}),e.promise},d}]),OrquestraUser.service("PinRepository",["$q","$http","Pin",function(a,b,c){var d={};return d.find=function(d){var e=a.defer();return b.get(api_v1("pin/"+d)).then(function(a){var b=new c;attr(b,a.data),e.resolve(b)}),e.promise},d.save=function(c){var d=a.defer(),e={name:c.name,desc:c.desc,device_id:c.device_id};return b.post(api_v1("pin/create"),e).then(function(a){c.id=a.data.id,d.resolve(c)},function(a){d.reject(c)}),d.promise},d.byDevice=function(d){var e=a.defer();return b.get(api_v1("pin/byDevice/"+d)).then(function(a){var b=_.map(a.data,function(a){var b=new c;return attr(b,a),b});e.resolve(b)}),e.promise},d}]),OrquestraUser.controller("BreadcumbCtrl",["$scope","Breadcumb",function(a,b){a.breadcumb=b}]),OrquestraUser.controller("DashboardIndexCtrl",["$scope","Breadcumb",function(a,b){b.title="Dashboard",b.items=[{text:"Dashboard"}],a.test="User Dashboard Index"}]),OrquestraUser.controller("DeviceCreateCtrl",["$scope","$state","Breadcumb","CurrentUser","Device","DeviceRepository",function(a,b,c,d,e,f){c.items=[{url:"home",text:"Dashboard"},{text:"Novo Dispositivo"}],c.title="Novo Dispositivo",a.device=new e;var g=!1;a.create=function(){g||(g=!0,d.get().then(function(c){a.device.user_id=c.id,f.save(a.device).then(function(a){b.go("home")},function(a){g=!1,alert("Houve um erro na criação do dispositivo.")})}))}}]),OrquestraUser.controller("DeviceDetailCtrl",["$scope","$state","$stateParams","Breadcumb","DeviceRepository","PinRepository",function(a,b,c,d,e,f){d.items=[{url:"home",text:"Dashboard"},{text:"Dispositivo"}],a.createPin=function(){b.go("pin_create",{deviceId:c.deviceId})},e.find(c.deviceId).then(function(b){a.device=b,d.title=b.nickname,f.byDevice(b.id).then(function(b){a.pins=b})})}]),OrquestraUser.controller("LeftNavbarCtrl",["$scope","CurrentUser",function(a,b){b.get().then(function(b){a.user=b,b.devices().then(function(b){a.devices=b})})}]),OrquestraUser.controller("PinCreateCtrl",["$scope","$state","$stateParams","Breadcumb","Pin","PinRepository",function(a,b,c,d,e,f){d.title="Novo Pino",d.items=[{url:"home",text:"Dashboard"},{url:"device_detail({deviceId: "+c.deviceId+"})",text:"Dispositivo"},{text:"Novo Pino"}],a.pin=new e,a.pin.device_id=c.deviceId;var g=!1;a.create=function(){g||f.save(a.pin).then(function(a){b.go("device_detail",{deviceId:a.device_id})},function(a){alert("Houve um erro na criação do pino.")})}}]),OrquestraUser.controller("PinDetailCtrl",["$scope","$stateParams","Breadcumb","PinRepository",function(a,b,c,d){c.items=[{url:"home",text:"Dashboard"},{url:"device_detail({ deviceId: "+b.deviceId+"})",text:"Dispositivo"},{text:"Pino"}],d.find(b.pinId).then(function(b){a.pin=b,c.title=b.name})}]),OrquestraUser.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("home",{url:"/",views:{MainContent:{templateUrl:view("dashboard")}}}).state("pin_create",{url:"/{deviceId}/pin/create",views:{MainContent:{templateUrl:view("pin/create")}}}).state("pin_detail",{url:"/device/{deviceId}/pin/{pinId}",views:{MainContent:{templateUrl:view("pin/detail")}}}).state("device_create",{url:"/device/create",views:{MainContent:{templateUrl:view("device/create")}}}).state("device_detail",{url:"/device/{deviceId}",views:{MainContent:{templateUrl:view("device/detail")}}})}]);