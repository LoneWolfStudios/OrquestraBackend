/*! orquestra 2016-07-05 */
function view(a){return APP_URL+"/user/"+a}function api_v1(a){return APP_URL+"/api/v1/"+a}function attr(a,b){for(var c in b)a[c]=b[c]}var OrquestraUser=angular.module("OrquestraUser",["ui.router","angular-flot"]),APP_URL=$("#APP_URL").val();OrquestraUser.run([function(){}]),OrquestraUser.factory("Constraint",[function(){var a=new Function;return a}]),OrquestraUser.factory("Device",["PinRepository",function(a){var b=new Function;return b.prototype.pins=function(){return a.byDevice(this.id)},b}]),OrquestraUser.factory("Pin",[function(){var a=new Function;return a}]),OrquestraUser.factory("PinData",[function(){var a=new Function;return a}]),OrquestraUser.factory("User",["DeviceRepository",function(a){var b=new Function;return b.prototype.devices=function(){return a.byUser(this.id)},b}]),OrquestraUser.factory("Visualization",[function(){var a=new Function;return a}]),OrquestraUser.factory("VisualizationData",[function(){var a=new Function;return a}]),OrquestraUser.service("Breadcumb",[function(){var a=this;a.title="Teste",a.items=[]}]),OrquestraUser.service("CurrentUser",["$http","$q","User",function(a,b,c){var d=this,e=!1;d.get=function(){var d=b.defer();return e?d.resolve(e):a.get(api_v1("user")).then(function(a){var b=new c;_.extend(b,a.data),e=b,d.resolve(e)}),d.promise}}]),OrquestraUser.service("ConstraintRepository",["$q","$http","Constraint",function(a,b,c){var d={};return d.find=function(d){var e=a.defer();return b.get(api_v1("constraint/find/"+d)).then(function(a){var b=new c;attr(b,a.data),e.resolve(b)}),e.promise},d.save=function(c){var d=a.defer(),e=JSON.stringify(c);return b.post(api_v1("constraint/create"),e).then(function(a){c.id=a.data.id,d.resolve(c)},function(a){d.reject(c)}),d.promise},d.byDevice=function(d){var e=a.defer();return b.get(api_v1("constraint/byDevice/"+d)).then(function(a){var b=_.map(a.data,function(a){var b=new c;return attr(b,a),b});e.resolve(b)}),e.promise},d}]),OrquestraUser.service("DeviceRepository",["$http","$q","Device",function(a,b,c){var d={};return d.find=function(d){var e=b.defer();return a.get(api_v1("device/find/"+d)).then(function(a){var b=new c;attr(b,a.data),e.resolve(b)}),e.promise},d.save=function(c){var d=b.defer(),e=JSON.stringify(c);return a.post(api_v1("device/create"),e).then(function(a){c.id=a.data.id,d.resolve(c)},function(a){d.reject(a)}),d.promise},d.byUser=function(d){var e=b.defer();return a.get(api_v1("device/byUser/"+d)).then(function(a){var b=_.map(a.data,function(a){var b=new c;return attr(b,a),b});e.resolve(b)}),e.promise},d}]),OrquestraUser.service("PinDataRepository",["$q","$http","PinData",function(a,b,c){var d={};return d.byPin=function(d){var e=a.defer();return b.get(api_v1("data/byPin/"+d)).then(function(a){var b=_.map(a.data,function(a){var b=new c;return attr(b,a),b});e.resolve(b)}),e.promise},d}]),OrquestraUser.service("PinRepository",["$q","$http","Pin",function(a,b,c){var d={};return d.find=function(d){var e=a.defer();return b.get(api_v1("pin/find/"+d)).then(function(a){var b=new c;attr(b,a.data),e.resolve(b)}),e.promise},d.save=function(c){var d=a.defer(),e=JSON.stringify(c);return b.post(api_v1("pin/create"),e).then(function(a){c.id=a.data.id,d.resolve(c)},function(a){d.reject(c)}),d.promise},d.byDevice=function(d){var e=a.defer();return b.get(api_v1("pin/byDevice/"+d)).then(function(a){var b=_.map(a.data,function(a){var b=new c;return attr(b,a),b});e.resolve(b)}),e.promise},d}]),OrquestraUser.service("VisualizationRepository",["$http","$q","Visualization","VisualizationData",function(a,b,c,d){var e={};return e.find=function(d){var e=b.defer();return a.get(api_v1("visualization/find/"+d)).then(function(a){var b=new c;attr(b,a.data),e.resolve(b)}),e.promise},e.save=function(c){var d=b.defer(),e=JSON.stringify(c);return a.post(api_v1("visualization/create"),e).then(function(a){c.id=a.data.id,d.resolve(c)},function(a){d.reject(a)}),d.promise},e.byDevice=function(d){var e=b.defer();return a.get(api_v1("visualization/byDevice/"+d)).then(function(a){var b=_.map(a.data,function(a){var b=new c;return attr(b,a),b});e.resolve(b)}),e.promise},e.dataAll=function(c){var e=b.defer();return a.get(api_v1("visualization/data/"+c+"/all")).then(function(a){var b=_.map(a.data,function(a){var b=new d;return attr(b,a),b});e.resolve(b)}),e.promise},e}]),OrquestraUser.controller("BreadcumbCtrl",["$scope","Breadcumb",function(a,b){a.breadcumb=b}]),OrquestraUser.controller("ConstraintCreateCtrl",["$scope","$state","$stateParams","Breadcumb","Constraint","VisualizationRepository","ConstraintRepository",function(a,b,c,d,e,f,g){d.title="Novo Gatilho",d.items=[{url:"home",text:"Dashboard"},{url:"device_detail({deviceId: "+c.deviceId+"})",text:"Dispositivo"},{text:"Novo Gatilho"}],a.constraint=new e,a.constraint.device_id=c.deviceId;var h=!1;a.create=function(){h||g.save(a.constraint).then(function(a){b.go("device_detail",{deviceId:a.device_id})},function(a){alert("Houve um erro na criação do gatilho.")})},f.byDevice(c.deviceId).then(function(b){a.visualizations=b},function(a){alert("Houve um erro na obtenção da lista de visualizações")})}]),OrquestraUser.controller("ConstraintDetailCtrl",["$scope","$stateParams","Breadcumb","ConstraintRepository",function(a,b,c,d){c.items=[{url:"home",text:"Dashboard"},{url:"device_detail({ deviceId: "+b.deviceId+"})",text:"Dispositivo"},{text:"Pino"}],d.find(b.constraintId).then(function(b){a.constraint=b,c.title=b.name},function(){alert("Não foi possivel obter informações do gatilho")})}]),OrquestraUser.controller("DashboardIndexCtrl",["$scope","Breadcumb",function(a,b){b.title="Dashboard",b.items=[{text:"Dashboard"}],a.test="User Dashboard Index"}]),OrquestraUser.controller("DeviceCreateCtrl",["$scope","$state","Breadcumb","CurrentUser","Device","DeviceRepository",function(a,b,c,d,e,f){c.items=[{url:"home",text:"Dashboard"},{text:"Novo Dispositivo"}],c.title="Novo Dispositivo",a.device=new e;var g=!1;a.create=function(){g||(g=!0,d.get().then(function(c){a.device.user_id=c.id,f.save(a.device).then(function(a){b.go("home")},function(a){g=!1,alert("Houve um erro na criação do dispositivo.")})}))}}]),OrquestraUser.controller("DeviceDetailCtrl",["$scope","$state","$stateParams","Breadcumb","DeviceRepository","PinRepository","VisualizationRepository","ConstraintRepository",function(a,b,c,d,e,f,g,h){d.items=[{url:"home",text:"Dashboard"},{text:"Dispositivo"}],e.find(c.deviceId).then(function(b){a.device=b,d.title=b.nickname,f.byDevice(b.id).then(function(b){a.pins=b},function(a){alert("Houve um erro na obtenção da lista de pinos")}),g.byDevice(b.id).then(function(b){a.visualizations=b},function(a){alert("Houve um erro na obtenção da lista de visualizações")}),h.byDevice(b.id).then(function(b){a.constraints=b},function(a){alert("Houve um erro na obtenção da lista de gatilhos")})})}]),OrquestraUser.controller("LeftNavbarCtrl",["$scope","CurrentUser",function(a,b){b.get().then(function(b){a.user=b,b.devices().then(function(b){a.devices=b})})}]),OrquestraUser.controller("PinCreateCtrl",["$scope","$state","$stateParams","Breadcumb","Pin","PinRepository",function(a,b,c,d,e,f){d.title="Novo Pino",d.items=[{url:"home",text:"Dashboard"},{url:"device_detail({deviceId: "+c.deviceId+"})",text:"Dispositivo"},{text:"Novo Pino"}],a.pin=new e,a.pin.device_id=c.deviceId;var g=!1;a.create=function(){g||f.save(a.pin).then(function(a){b.go("device_detail",{deviceId:a.device_id})},function(a){alert("Houve um erro na criação do pino.")})}}]),OrquestraUser.controller("PinDetailCtrl",["$scope","$stateParams","Breadcumb","PinRepository","PinDataRepository",function(a,b,c,d,e){c.items=[{url:"home",text:"Dashboard"},{url:"device_detail({ deviceId: "+b.deviceId+"})",text:"Dispositivo"},{text:"Pino"}],a.chartOptions={legend:{show:!0,container:"#chart-legends"},series:{lines:{lineWidth:1}},xaxis:{mode:"time",timezone:"browser",position:"bottom",timeFormat:"%H:%M:%S"}},d.find(b.pinId).then(function(b){a.pin=b,c.title=b.name,e.byPin(b.id).then(function(c){a.chartDataset=[{color:"blue",label:b.name,shadowSize:0,data:_.map(c,function(a){return[new Date(a.created_at),a.value]})}]},function(a){alert("Não foi possivel obter os dados do pino.")})},function(){alert("Não foi possivel obter informações do pino")})}]),OrquestraUser.controller("VisualizationCreateCtrl",["$scope","$state","$stateParams","Breadcumb","Visualization","VisualizationRepository","PinRepository",function(a,b,c,d,e,f,g){d.title="Novo Pino",d.items=[{url:"home",text:"Dashboard"},{url:"device_detail({deviceId: "+c.deviceId+"})",text:"Dispositivo"},{text:"Nova Visualização"}],a.visualization=new e,a.visualization.device_id=c.deviceId;var h=!1;a.create=function(){h||(h=!0,a.visualization.x_id?f.save(a.visualization).then(function(a){b.go("device_detail",{deviceId:a.device_id})},function(a){alert("Houve um erro na criação do pino."),h=!1}):(alert("Você deve escolher ao menos um pino. Sempre do x ao z."),h=!1))},g.byDevice(c.deviceId).then(function(b){a.pins=b},function(a){alert("Houve um erro na obtenção dos pinos deste dispositivo")})}]),OrquestraUser.controller("VisualizationDetailCtrl",["$scope","$stateParams","Breadcumb","VisualizationRepository",function(a,b,c,d){c.items=[{url:"home",text:"Dashboard"},{url:"device_detail({ deviceId: "+b.deviceId+"})",text:"Dispositivo"},{text:"Visualização"}],a.chartOptions={legend:{show:!0,container:"#chart-legends"},series:{lines:{lineWidth:1}},xaxis:{mode:"time",timezone:"browser",position:"bottom",timeFormat:"%H:%M:%S"}},d.find(b.visualizationId).then(function(b){a.visualization=b,c.title=b.name,d.dataAll(b.id).then(function(c){a.chartDataset=[{color:"blue",label:b.name,shadowSize:0,data:_.map(c,function(a){return[new Date(a.created_at),a.value]})}]},function(a){alert("Não foi possivel obter os dados da visualização.")})},function(){alert("Não foi possivel obter informações da visualização")})}]),OrquestraUser.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("home",{url:"/",views:{MainContent:{templateUrl:view("dashboard")}}}).state("constraint_create",{url:"/device/{deviceId}/constraint/create",views:{MainContent:{templateUrl:view("constraint/create")}}}).state("constraint_detail",{url:"/device/{deviceId}/constraint/{constraintId}",views:{MainContent:{templateUrl:view("constraint/detail")}}}).state("visualization_create",{url:"/device/{deviceId}/visualization/create",views:{MainContent:{templateUrl:view("visualization/create")}}}).state("visualization_detail",{url:"/device/{deviceId}/visualization/{visualizationId}",views:{MainContent:{templateUrl:view("visualization/detail")}}}).state("pin_create",{url:"/{deviceId}/pin/create",views:{MainContent:{templateUrl:view("pin/create")}}}).state("pin_detail",{url:"/device/{deviceId}/pin/{pinId}",views:{MainContent:{templateUrl:view("pin/detail")}}}).state("device_create",{url:"/device/create",views:{MainContent:{templateUrl:view("device/create")}}}).state("device_detail",{url:"/device/{deviceId}",views:{MainContent:{templateUrl:view("device/detail")}}})}]);